<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>学校秀、班级秀</title>
    <script src="../js/mui.min.js"></script>
    <link href="../css/mui.css" rel="stylesheet"/>
	<link href="../css/icons-extra.css" rel="stylesheet"/>
	<link href="../css/app.css" rel="stylesheet"/>
  	<link href="../css/foot.css" rel="stylesheet"/>
	<link href="../css/dashboard.css" rel="stylesheet"/>
	<link href="../css/top.css" rel="stylesheet"/>
	<link href="../css/school/scShowAll.css" rel="stylesheet"/>
    <link href="../css/school/pushCommon.css" rel="stylesheet"/>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<img src="../images/head-dz.png" class="head-dz"/>
		<div  class="mui-segmented-control title-control">
			<a class="mui-control-item mui-active call-btn" href="#item1" id="it1">
				学校秀
			</a>
			<a class="mui-control-item guaji-btn" href="#item2" id="it2">
				班级秀
			</a>
		</div>
	</header>

	<nav id="main_bar" class="mui-bar mui-bar-tab">
		<a class="mui-tab-item" href="courseAll.html">
			<span class="mui-icon tabbar-ns-1 foot-icon"></span>
			<span class="mui-tab-label">课程</span>
		</a>
		<a class="mui-tab-item" href="activityList.html">
			<span class="mui-icon tabbar-ns-2 foot-icon"></span>
			<span class="mui-tab-label">活动</span>
		</a>
		<a class="mui-tab-item mui-active" href="scShowAll.html">
			<span class="mui-icon tabbar-ns-3 foot-icon"></span>
			<span class="mui-tab-label">成果</span>
		</a>
		<a class="mui-tab-item " href="personalCenter.html">
			<span class="mui-icon tabbar-ns-4 foot-icon"></span>
			<span class="mui-tab-label">我的</span>
			
		</a>
	</nav>

 
	<div id="item1" class="item-call mui-content mui-control-content mui-fullscreen mui-active" style="top:64px;bottom: 50px;">
		<div id="slider" class="mui-slider mui-fullscreen">				
			<div class="mui-slider-group">
				<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
					<div id="scroll1" class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<ul class="mui-table-view">									
								<!--<li class="mui-table-view-cell">
									<div class="works-desc">
										<div class="works-desc-top">
											<img src="../images/school/head-pic.png" class="works-img"/>
											<p class="works-username">赵先生 <label class="works-time">1小时前</label></p>
											<p class="works-content">摄影术的诞生是随着欧洲资本主义的发展应运而生的，150多年来，它经历了一个由简单到复杂。</p>
											<div >
												<img src="../images/bigicon3.png" class="works-desc-pic"/>
												<img src="../images/bigicon3.png" class="works-desc-pic"/>
												<img src="../images/bigicon3.png" class="works-desc-pic"/>
												<img src="../images/bigicon3.png" class="works-desc-pic"/>
												<img src="../images/bigicon3.png" class="works-desc-pic"/> 
											</div>
											<div class="icon-line">
												<span class="mui-icon-extra mui-icon-extra-comment"> 24</span>
												<span class="mui-icon-extra mui-icon-extra-like"> 111</span>
											</div>
											<div class="works-answer">
												<img src="../images/bigicon1.png" class="works-img"/>
												<p class="works-username">赵先生 <label class="works-time">1小时前</label></p>
												<p class="works-content">太棒了，很不错。</p>
											</div>
											<div class="works-answer">
												<img src="../images/bigicon1.png" class="works-img"/>
												<p class="works-username">赵先生 <label class="works-time">1小时前</label></p>
												<p class="works-content">太棒了，很不错。</p>
											</div>
										</div>
									</div>
								</li>-->
								<li class="mui-table-view-cell">
									<div class="works-desc">
										<div class="works-desc-top">
											<img src="../images/school/head-pic.png" class="works-img"/>
											<p class="works-username">赵先生 <label class="works-time">1小时前</label></p>
											<p class="works-content">摄影术的诞生是随着欧洲资本主义的发展应运而生的，150多年来，它经历了一个由简单到复杂。</p>
											<div >
												<img src="../images/bigicon3.png" class="works-desc-pic"/>
												<img src="../images/bigicon3.png" class="works-desc-pic"/>
												<img src="../images/bigicon3.png" class="works-desc-pic"/>
											</div>
											<div class="icon-line">
												<span class="mui-icon-extra mui-icon-extra-comment"> 24</span>
												<span class="mui-icon-extra mui-icon-extra-like"> 111</span>
											</div>
											<div class="works-answer">
												<img src="../images/bigicon1.png" class="works-img"/>
												<p class="works-username">赵先生 <label class="works-time">1小时前</label></p>
												<p class="works-content">太棒了，很不错。</p>
											</div>
											<div class="works-answer">
												<img src="../images/bigicon1.png" class="works-img"/>
												<p class="works-username">赵先生 <label class="works-time">1小时前</label></p>
												<p class="works-content">太棒了，很不错。</p>
											</div>
										</div>
									</div>
								</li>
							</ul>
						</div>
					</div>
				</div>
				
			</div>
		</div>
	</div>

	
	<div id="item2" class="item-call mui-content mui-control-content mui-fullscreen" style="top:64px;bottom: 50px;">
		<div id="slider" class="mui-slider mui-fullscreen">				
			<div class="mui-slider-group">
				<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
					<div id="scroll1" class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<ul class="mui-table-view">
								
								<li class="mui-table-view-cell">
									<div class="show-desc">
										<div class="show-desc-right">
											<img src="../images/school/show-yes.png" class="show-icon">
											<p>已参加</p>
										</div>
										<div class="show-desc-left">
											<p class="show-desc-title">欢乐中国豫园行</p>
											<p class="show-desc-content">发布人：赵先生</p>
											<p class="show-desc-content">2017-07-25</p>
										</div>
									</div>
								</li>
								<!--<li class="mui-table-view-cell">
									<div class="show-desc">
										<div class="show-desc-right">
											<img src="../images/school/show-no.png" class="show-icon">
											<p>未参加</p>
										</div>
										<div class="show-desc-left">
											<p class="show-desc-title">欢乐中国豫园行</p>
											<p class="show-desc-content">发布人：赵先生</p>
											<p class="show-desc-content">2017-07-25</p>
										</div>
									</div>
								</li>-->
								 
							</ul>
						</div>
					</div>
				</div>				
			</div>
		</div>
	</div>

<script src="../js/jquery-2.1.4.min.js"></script>
<script src="../js/mui.min.js"></script>
<script src="../js/mui.pullToRefresh.js"></script>
<script src="../js/mui.pullToRefresh.material.js"></script>
<script src="../js/app.js"></script>
<script type="text/javascript" charset="UTF-8">
  	mui.init();
    mui('#main_bar').on('tap', 'a', function(e) {
	    //获取目标子页的id
	    var targetTab = this.getAttribute('href');
	    window.location.href=targetTab;
	});
	(function($) {
		//阻尼系数
		var deceleration = mui.os.ios?0.003:0.0009;
		var pageIndex = 1;
		var color_css = new Array("sc_purple","sc_cyan","sc_orange","sc_pink")
		$('.mui-scroll-wrapper').scroll({
			bounce: false,
			indicators: true, //是否显示滚动条
			deceleration:deceleration
		});
		$.ready(function() {
			//循环初始化所有下拉刷新，上拉加载。
			$.each(document.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
				var actFine = index==0?2:1; // 2：学校秀，1：班级秀
				$(pullRefreshEl).pullToRefresh({
					down: {
						callback: function() {
							var self = this;
							var userInfo = app.getState();
							if(userInfo.manageId!=undefined && userInfo.manageId!=''){
								app.getShowAll(userInfo,actFine,5,1,function(data){
									if(data.code==0){												
										var ul = self.element.querySelector('.mui-table-view');
										ul.innerHTML="";
										ul.insertBefore(createFragment(actFine,ul, data.object.rows), ul.firstChild);
									 	 pageIndex=1;
									}else{
										mui.toast(data.msg);
									}
									
										self.endPullDownToRefresh();
								});
							}else{
								app.gotoLogin();
							}
						}
					},
					up: {
						callback: function() {
							var self = this;
							var aa = index;
							var userInfo = app.getState(); 
							if(userInfo.manageId!=undefined && userInfo.manageId!=''){
								app.getShowAll(userInfo,actFine,5,pageIndex+1,function(data){
									if(data.code==0){												
										var ul = self.element.querySelector('.mui-table-view'); 
										ul.appendChild(createFragment(actFine,ul, data.object.rows), ul.firstChild);
									 	 pageIndex++;
									}else{
										mui.toast(data.msg);
									}
									
										self.endPullUpToRefresh();
								});
							}else{
								app.gotoLogin();
							}
						}
					}
				});
			});
			var createFragment = function(actFine,ul, objectList) {
				var length = ul.querySelectorAll('li').length;
				var fragment = document.createDocumentFragment();
				var li;
				objectList=objectList==undefined?[]:objectList;
				for (var i = 0; i < objectList.length; i++) {
					li = document.createElement('li');
					li.className = 'mui-table-view-cell';
					var insertHtml="";
					if(actFine==2){ //学校秀
						
						insertHtml+="<div class=\"works-desc\">";
						insertHtml+="	<div class=\"works-desc-top\">";
						if(objectList[i].actSponsorType==2){
							insertHtml+="		<img src=\""+objectList[i].showTeacherPic+"\" class=\"works-img\"/>";
						}else{
							insertHtml+="		<img src=\""+objectList[i].showStudentPic+"\" class=\"works-img\"/>";
						}
						
						insertHtml+="		<p class=\"works-username\">"+objectList[i].actOperName+"<label class=\"works-time\">"+objectList[i].actTime+"</label></p>";
						insertHtml+="		<p class=\"works-content\">"+objectList[i].actDesc+"</p>";
						insertHtml+="		<div >";
						insertHtml+="			<img src=\""+objectList[i].actFiles+"\" class=\"works-desc-pic\"/>";
						//insertHtml+="			<img src=\"../images/bigicon3.png\" class=\"works-desc-pic\"/>";
						//insertHtml+="			<img src=\"../images/bigicon3.png\" class=\"works-desc-pic\"/>";
						insertHtml+="		</div>";
						insertHtml+="		<div class=\"icon-line\">";
						insertHtml+="			<span class=\"mui-icon-extra mui-icon-extra-comment\">"+objectList[i].actFinePintNum+"</span>";
						insertHtml+="			<span class=\"mui-icon-extra mui-icon-extra-like\">"+objectList[i].actFineCommentNum+"</span>";
						insertHtml+="		</div>";
						
						var activityCommentList = objectList[i].activityCommentList;
						for(var h=0;h<activityCommentList.length;h++){
							
							insertHtml+="		<div class=\"works-answer\">";
							if(activityCommentList[h].actIsTeacher==2){
								insertHtml+="			<img src=\""+activityCommentList[h].showStudentPic+"\" class=\"works-img\"/>";
							}else{
								insertHtml+="			<img src=\""+activityCommentList[h].showTeacherPic+"\" class=\"works-img\"/>";
							}
							
							insertHtml+="			<p class=\"works-username\">"+activityCommentList[h].actComReviewer+"<label class=\"works-time\">"+activityCommentList[h].actComTime+"</label></p>";
							insertHtml+="			<p class=\"works-content\">"+activityCommentList[h].actComDesc+"</p>";
							insertHtml+="		</div>";
						}
						
						// 可以注释掉部分 下
//						insertHtml+="		<div class=\"works-answer\">";
//						insertHtml+="			<img src=\"../images/bigicon1.png\" class=\"works-img\"/>";
//						insertHtml+="			<p class=\"works-username\">赵先生 <label class=\"works-time\">1小时前</label></p>";
//						insertHtml+="			<p class=\"works-content\">太棒了，很不错。</p>";
//						insertHtml+="		</div>";
						//可以注释掉部分 上
						
						insertHtml+="	</div>";
						insertHtml+="</div>";
					}else if(actFine==1){//班级秀
						insertHtml+="<div class=\"show-desc\">";
						insertHtml+="	<div class=\"show-desc-right\">";
						if(objectList[i].hasPart==1){
							insertHtml+="		<img src=\"../images/school/show-yes.png\" class=\"show-icon\">";
						}else{
							insertHtml+="		<img src=\"../images/school/show-no.png\" class=\"show-icon\">";
						}
						insertHtml+="		<p>已参加</p>";
						insertHtml+="	</div>";
						insertHtml+="	<div class=\"show-desc-left\">";
						insertHtml+="		<p class=\"show-desc-title\">"+objectList[i].actName+"</p>";
						insertHtml+="		<p class=\"show-desc-content\">发布人："+objectList[i].actOperName+"</p>";
						insertHtml+="		<p class=\"show-desc-content\">"+objectList[i].actTime+"</p>";
						insertHtml+="	</div>";
						insertHtml+="</div>";						 
					}
					li.innerHTML = insertHtml;
					fragment.appendChild(li);
				}
				return fragment;
			};
		});
	})(mui);
	
	mui.plusReady(function () {
			var backButtonPress = 0;
			mui.back = function(event) {
				backButtonPress++;
				if (backButtonPress > 1) {
					plus.runtime.quit();
					app.logout();
				} else {
					plus.nativeUI.toast('再按一次退出应用');
				}
				setTimeout(function() {
					backButtonPress = 0;
				}, 1000);
				return false;
			}; 
			
		})
</script>
</body>
</html>